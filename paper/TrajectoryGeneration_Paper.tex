%% LyX 2.3.7 created this file.  For more info, see http://www.lyx.org/.
%% Do not edit unless you really know what you are doing.
\documentclass[10pt,letterpaper,conference]{ieeeconf}
\usepackage[latin9]{inputenc}
\usepackage{array}
\usepackage{mathtools}
\usepackage{url}
\usepackage{multirow}
\usepackage{amsmath}
\usepackage{wasysym}

\makeatletter

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% LyX specific LaTeX commands.
%% Because html converters don't know tabularnewline
\providecommand{\tabularnewline}{\\}

\@ifundefined{date}{}{\date{}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% User specified LaTeX commands.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Written by   Layne Clemen and Cory Rupp                            %
%              ATA Engineering                                       %
%              San Diego, CA 92128                                   %
%              WWW:   www.ata-e.com                                  %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\IEEEoverridecommandlockouts
\overrideIEEEmargins

%%%%%%%%%%%%%%%%%%%%%%%%%% Packages %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{pgfplots}
\usepgfplotslibrary{groupplots}
\pgfplotsset{
%	compat=1.3,
	tick label style={font=\small},
	label style={font=\small},
	height=0.4*\columnwidth, 
	width=\columnwidth
}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{tikz}
\usetikzlibrary{3d,
				calc,
				shapes,
 				decorations.pathmorphing}

%\usepackage{circuitikz}
%\usepackage{bondgraph}

%\usepackage{tablefootnote}
\newtheorem{remark}{Remark}


\title{\LARGE \bf
Single- and Multi-Degree of Freedom Servo Trajectory Generation: An
Optimization Framework, Implementation, and Examples
}
\author{Layne Clemen$^{1}$ and Cory J. Rupp$^{2,*}$%
\thanks{$^{1}$Elexity, Bend, OR, USA
	{\tt\small layne@elexity.io}}%
\thanks{$^{2}$ATA Engineering, Inc., Lakewood, CO, USA
	{\tt\small cory.rupp@ata-e.com}}%
\thanks{$^{*}$Corresponding author}%
}

\makeatother

\begin{document}
\maketitle
\thispagestyle{empty}
\pagestyle{empty}
\begin{abstract}
Single-axis motion profiles are typically generated by an engineer
through adjusting acceleration, jerk, and velocities at the bounds
of system specifications to find a trajectory that meets the system
performance requirements. This is an often trite task that does not
allow many secondary system performance options such as energy usage
to be considered. In multi-degree of freedom systems, secondary considerations
are typically brushed aside even more as the task complexity requires
more focus on the coordinate motion of multiple stages. This paper
presents an optimization framework to generate optimal trajectories
offline for single- and multi-axis systems based entirely on basic
kinematic relationships. The framework, implemented in the Python
package Pyomo, consists of setting a minimization target and appropriate
norm in conjunction of a set of operational constraints. Trajectory
generation results for minimal power, jerk, acceleration, and velocity
considerations using $\mathcal{L}_{1}$, $\mathcal{L}_{2}$, and $\mathcal{L}_{\infty}$
norms are compared. A nonlinear optimization scheme to minimize move
time is also examined. Results show that trapezoidal/S-curve profiles
embody minimization of velocity norms as well as move time, while
other optimal profiles can be utilized in cases where system specifications
require different performance options. Normalized peak power and total
system energy cost functions are also developed. This paper provides
practicing engineers with an easily implementable tool to facilitate
system component selection and performance optimization.
\end{abstract}


\section{INTRODUCTION\label{sec:Introduction}}

Trajectory generation is a well studied area with extensive literature
describing solutions for a myriad of applications~\cite{kroger2010literature,rao2014trajectory}.
Many applications consider multiple degree of freedom systems such
as robotic arms~\cite{kroger2010literature} and multi-axis machines~\cite{erkorkmaz2004optimal},
typically utilizing offline or online optimization techniques with
the dynamics of the actuators and controlled system as constraints.
An often overlooked application is trajectory generation for 1-dimensional
motion control systems such as basic linear motion stages. There have
been some recent developments for these simpler systems but not much
that is readily usable by the practicing engineering community~\cite{wang2014real}.

Two types of movement profiles are typically implemented in commercial
of the shelf (COTS) motor controllers: a trapezoidal profile or an
S-curve. Parameters for these profiles are commonly generated online
by tweaking the motion parameters until the engineer achieves acceptable
performance, usually focusing on one aspect (e.g., velocity or acceleration)
while disregarding other factors. While these profiles work well for
general applications, there exists a need to optimize systems for
additional performance metrics such as reducing controller and mechanical
energy usage and wear. Trajectory generation for multi-degree for
freedom platforms rarely considers such secondary as energy usage,
although their application are equally needed.

This paper presents a simple offline framework to generate motion
trajectories optimized under various performance objectives. This
framework casts trajectory generation as a continuous optimization
problem with constraints relating the kinematics of the system. The
theoretical development is implemented in Pyomo~\cite{hart2017pyomo},
an algebraic modeling language (AML) package for Python. Results show
that trapezoidal/S-curves embody trajectories that minimize of velocity
norms or move duration. Other cost functions and their implementations
are presented that can be utilized in cases where system specifications
require different performance options. Extension to multi degree of
freedom trajectory optimization is straightforward and a simple application
is demonstrated using the framework.

This paper is organized as follows, Section 2 presents a basic problem
formulation around a generic cost function with kinematic constraints.
Section 3 discusses implementation in the Pyomo package. Section 4
discusses the results of studies of a single axis system, including
exploration of a multi-objective formulation. In section 5, the framework
is extended to a two-degree of freedom system and demonstrated with
an example. Section 6 discusses conclusions and future extensions
of the work.

\section{PROBLEM FORMULATION\label{sec:ProblemFormulation}}

Trajectory motion consists of multiple kinematic variables, including
displacement $d$, velocity $v$, acceleration $a$, and jerk $j$,
all as a function of time and related through the kinematic equations

\begin{align}
\begin{split}\dot{d} & =v\\
\dot{v} & =a\\
\dot{a} & =j
\end{split}
\label{eq:dynamics}
\end{align}

These variables are typically subject to a variety of constraints
on their possible values

\begin{align}
\begin{split}\underline{v}\leq v\leq\overline{v}\\
\underline{a}\leq a\leq\overline{a}\\
\underline{j}\leq j\leq\overline{j}
\end{split}
\end{align}

where upper $\overline{\APLbox}$ and lower $\underline{\APLbox}$
limits are determined through electromechanical system requirements
and specifications. The trajectory optimization problem can be formulated
as a standard optimization~\cite{nocedal2006numerical} of the form:
\begin{align}
\begin{split} & \min\limits _{\mathbf{x}}\;J\\
s.t.\quad & \mathbf{Ax}=\mathbf{b}\\
 & \mathbf{Hx}\leq\mathbf{k}
\end{split}
\label{eq:optStatement}
\end{align}
where $J$ is the cost or objective function, $\mathbf{x}$ is the
vector of decision variables, and $\mathbf{A}$, $\mathbf{b}$, $\mathbf{H}$,
and $\mathbf{k}$ are appropriately sized matrices and vectors describing
the problem constraints. The kinematic motion of the system \ref{eq:dynamics}
can be discretized and used as constraint equations between the decision
variables:

\begin{align}
\begin{split}d_{k+1}=d_{k}+v_{k}\Delta t\\
v_{k+1}=v_{k}+a_{k}\Delta t\\
a_{k+1}=a_{k}+j_{k}\Delta t
\end{split}
\label{eq:kinematicConstraints}
\end{align}

These constraints, the decision variable box constraints, and boundary
conditions for a motion starting and stopping at rest\footnote{Different boundary conditions can be used without loss of generality.}
can be used to formulate the optimization problem as: 
\begin{align}
\begin{array}{rl}
 & \min\limits _{\mathbf{x}}\;J\\
\begin{array}{l}
s.t.\\
\\
\\
\\
\\
\\
\\
\\
\\
\\
\\
\\
\end{array} & \left.\begin{array}{l}
x_{0}=0\\
v_{0}=0\\
a_{0}=0\\
d_{k+1}=d_{k}+v_{k}\Delta t\\
v_{k+1}=v_{k}+a_{k}\Delta t\\
a_{k+1}=a_{k}+j_{k}\Delta t\\
d_{N}=D\\
v_{N}=0\\
a_{N}=0\\
0\leq v_{k}\leq\overline{v}\\
\underline{a}\leq a_{k}\leq\overline{a}\\
\underline{j}\leq j_{k}\leq\overline{j}
\end{array}\right\} \mathcal{C}
\end{array}\label{eq:baseProgram}
\end{align}
where $D$ is the total distance to move, $\Delta t$ is the discretization
period, and $\mathcal{C}$ is the entire set of constraints for the
problem. The kinematic variables are discretized into $k\in\left[1,\;2,\;\ldots\;,\;N-1,\;N\right]$
indexes totaling $N$ segments, where 
\begin{equation}
N=\dfrac{t_{f}}{\Delta t}
\end{equation}
Depending on the cost function, the decision variables $\mathbf{x}$
will consist of either the kinematic variables\footnote{The variables here represent a linear mechanical system but can be
changed to any energy domain without loss of generality~\cite{karnopp2012system}.} $\mathbf{d}$, $\mathbf{v}$, $\mathbf{a}$, $\mathbf{j}$ or the
total move time $t_{f}$. 

\subsection{Minimizing Kinematic Variables}

The cost function when using kinematic variables is formulated in
terms of $\mathcal{L}_{1}$, $\mathcal{L}_{2}$, or $\mathcal{L}_{\infty}$
norms of the vectors of the decision variables. These norms represent
various aspects of the profile performance, they are\footnote{The 2-norm only varies from the RMS value by a constant of $1/\sqrt{n}$
and therefore behaves the same under optimization.}:

\noindent %
\begin{tabular}{lr}
$\|\mathbf{x}\|_{1}=\sum\limits _{i=1}^{n}|x_{i}|$ & (Absolute or Taxicab Norm)\tabularnewline
$\|\mathbf{x}\|_{2}=\left(\sum\limits _{i=1}^{n}x_{i}^{2}\right)^{1/2}$ & (RMS or Euclidean Norm)\tabularnewline
$\|\mathbf{x}\|_{\infty}=\max\limits _{1\leq i\leq n}|x_{i}|$ & (Peak or Inifinty Norm)\tabularnewline
\end{tabular}

\subsection{Minimizing Power and Energy}

For a linear mechanical system with a constant mass, the power that
the load experiences is
\begin{equation}
P_{k}=F_{k}v_{k}
\end{equation}

where $F_{k}$ is the force on the system at step $k$. The time-vector
of forces, acceleration, and velocity are 
\begin{align}
\begin{split}\mathbf{F} & =\left[F_{1},F_{2},\ldots,F_{N}\right]^{T}\\
\mathbf{a} & =\left[a_{1},a_{2},\ldots,a_{N}\right]^{T}\\
\mathbf{v} & =\left[v_{1},v_{2},\ldots,v_{N}\right]^{T}
\end{split}
\end{align}

From Newton's 2\textsuperscript{nd} law $\mathbf{F}=m\mathbf{a}$,
the instantaneous power delivered to the load is the Hadamard product
of $\mathbf{F}$ and $\mathbf{v}$ 
\begin{equation}
\mathbf{P}=\mathbf{F}\circ\mathbf{v}=(m\mathbf{a})\circ\mathbf{v}
\end{equation}

Because norms have the property with constant $c$
\begin{equation}
\|c\mathbf{x}\|_{p}=c\|\mathbf{x}\|_{p}
\end{equation}

and mass is constant, the objective to minimize the norm of the power
can be reduced to
\begin{equation}
J=\|\mathbf{P}\|_{p}=m\|\mathbf{a}\circ\mathbf{v}\|_{p}\label{eq:power_norm}
\end{equation}

Therefore, combining the optimization problem \eqref{eq:baseProgram}
with \eqref{eq:power_norm} will yield minimization of the RMS power
for $p=2$ and the peak power for $p=\infty$. This can be used to
meet system requirements, such as motor driver specification. It is
noted that using the $\mathcal{L}_{1}$-norm (i.e., $p=1$) of power
as the cost function will also minimize the total energy of the movement.
This can be shown by writing the total energy as the absolute sum
of the instantaneous power multiplied by the constant time interval
$\Delta t$ (assuming constant power between intervals) and then using
the definition of the $\mathcal{L}_{1}$-norm: 
\begin{equation}
E_{total}=\sum\limits _{i=1}^{n}|P_{i}\Delta t|=\sum\limits _{i=1}^{n}|P_{i}|\Delta t=\|\mathbf{P}\|_{1}\Delta t=m\|\mathbf{a}\circ\mathbf{v}\|_{1}\Delta t\label{eq:energy}
\end{equation}

\begin{remark} These costs functions can easily be extended to a
time-varying mass if the mass-time profile is known \textit{a priori}.
The time-varying mass would effectively weight the entries of the
power vector. \end{remark}

\begin{remark} The minimization of power produces a lower bound on
the power the actuator must inject into the system. In a real system,
one would also have to account for the system friction. To do this,
it can be assumed that the friction has the form
\begin{equation}
\mathbf{F}_{friction}=f(\mathbf{v})
\end{equation}
The total force to move the mass would be
\begin{equation}
\mathbf{F}=f(\mathbf{v})+m\mathbf{a}
\end{equation}
whereby trajectory optimization would now reference the cost function
\begin{equation}
J=\|(f(\mathbf{v})+m\mathbf{a})\circ\mathbf{v}\|_{p}
\end{equation}
to account for friction. Further discussion of this approach is out
of the scope of this paper. \end{remark}

\subsection{Minimizing Move Time}

In order to minimize the move time step, $\Delta t$ is added as a
decision variable. The cost function becomes 
\begin{equation}
J=N\Delta t
\end{equation}
where $N$ is again the number of time steps. It is important here
to ensure that the time discretization factor $N$ is large enough
to accurately capture the system dynamics throughout the range of
$\Delta t$ encountered while solving the optimization problem. An
easy way to do this would be to add side constraints to the permissible
of $\Delta t$ into \eqref{eq:kinematicConstraints} and selecting
a value of $N$ that is sufficient for the worst case. 

In this cost function formulation, the distance constraint of \eqref{eq:baseProgram}
must be reformulated as 
\begin{equation}
\sum\limits _{k=1}^{N}v_{k}\Delta t=D
\end{equation}
which happens to be the product of two decision variables. As a consequence,
a side effect of this formulation is the introduction of nonlinear
constraint functions (the kinematic constraints \eqref{eq:kinematicConstraints}
also become nonlinear). These nonlinearities have downstream implications
on the selection of appropriate optimization algorithms for solving
the move time minimization problem.

\section{IMPLEMENTATION NOTES\label{sec:Implementation}}

The use of algebraic modeling languages makes trajectory optimization
programs such as those presented much more accessible to practicing
engineers with limited knowledge of optimization solvers and nomenclature.
With that said that are two aspects to note when implementing these
programs in an AML package. For this paper, the above problems were
implemented using Pyomo, for which the range of math functions that
are available for the solvers is limited. For example, norms are not
supported so additional decision variables, constraints, and cost
function changes were required to complete the problem formulation.
These adaptation are described here. The optimization code used in
this paper is provided on GitHub at \url{TBDsite}. 

\subsection{Absolute Norm ($\mathcal{L}_{1}$)}

Introduce a new variable $X_{k}$ for each element in $\mathbf{x}$.
For each new variable, implement the two-sided constraint 
\begin{equation}
-x_{k}\leq X_{k}\leq x_{k}\label{eq:1norm}
\end{equation}
The cost function becomes 
\begin{equation}
J=\sum_{k=1}^{N}X_{k}
\end{equation}
Using these relationships in \eqref{eq:baseProgram} results in the
following optimization program 
\begin{align}
\begin{split}\min\limits _{\mathbf{d},\mathbf{v},\mathbf{a},\mathbf{j},\mathbf{X}}\quad & \sum\limits _{k=1}^{\infty}X_{k}\\
s.t.\quad & \mathcal{C}\\
 & X_{k}\leq x_{k}\\
 & X_{k}\geq-x_{k}
\end{split}
\end{align}
where $\mathbf{x}$ may be $\mathbf{v}$, $\mathbf{a}$, $\mathbf{j}$,
or $\mathbf{P}$.

\subsection{RMS Norm ($\mathcal{L}_{2}$)}

Pyomo does not allow use of the square root function so a straight
minimization of an RMS value is not possible. It can be shown, however,
that minimizing the sum of squares is equivalent to minimizing the
RMS value. This results in the following optimization program 
\begin{align}
\begin{split}\min\limits _{\mathbf{d},\mathbf{v},\mathbf{a},\mathbf{j}}\quad & \sum\limits _{k=1}^{\infty}x_{k}^{2}\\
s.t.\quad & \mathcal{C}
\end{split}
\end{align}
where $\mathbf{x}$ may be $\mathbf{v}$, $\mathbf{a}$, $\mathbf{j}$,
or $\mathbf{P}$.

\subsection{Peak Norm ($\mathcal{L}_{\infty}$)}

Introduce the same variables and constraints as in \eqref{eq:1norm}
as well as a new variable $\bar{X}$. Add the following constraint
for each variable, $X_{k}$ 
\begin{equation}
X_{k}\leq\bar{X}
\end{equation}
and the cost function becomes 
\begin{equation}
J=\bar{X}
\end{equation}
The resulting optimization program is 
\begin{align}
\begin{split}\min\limits _{\mathbf{d},\mathbf{v},\mathbf{a},\mathbf{j},\bar{X}}\quad & \bar{X}\\
s.t.\quad & \mathcal{C}\\
 & X_{k}\leq\bar{X}\\
 & X_{k}\leq x_{k}\\
 & X_{k}\geq-x_{k}
\end{split}
\end{align}
where $\mathbf{x}$ may be $\mathbf{v}$, $\mathbf{a}$, $\mathbf{j}$,
or $\mathbf{P}$.

\subsection{Minimum Total Energy Formulation}

To minimize the total energy of the move, \eqref{eq:energy} is used
for the cost function. Since the mass $m$ and time step $\Delta t$
are considered constant here, this results in the following optimization
program
\begin{align}
\begin{split}\min\limits _{\mathbf{v},\,\mathbf{a},\,\mathbf{j}}\quad & m\Delta t\mathbf{a}^{T}\mathbf{v}\\
s.t.\quad & \mathcal{C}
\end{split}
\end{align}


\section{SINGLE-AXIS EXAMPLE AND RESULTS\label{sec:SingleAxisResults}}

To demonstrate the above trajectory optimization formulations, a realistic
problem for a small single axis motion system is used. The set of
system parameters and constraints are provided in Table \ref{tab:sysParams}.
Trajectory optimization results are shown for minimizing velocity,
acceleration, jerk, power, and time. In the case of velocity minimization,
two different bounds on the jerk were used to show the effects of
the amount of jerk in the system. As explained previously, minimizing
total energy is equivalent to minimizing the $\mathcal{L}_{1}$-norm
of power, so this case is redundant. Peak power and energy usage minimization
are compared between the different cases before exploring the relationship
between the two in a multi-objective minimization problem. In all
simulations the Generalized Disjunctive Programming optimizer was
used (referenced as gdpopt within Pyomo \cite{pyomogdpoptwebsite}),
although other optimizers also worked well on these problems.

\begin{table}[h]
\caption{System parameters}
\label{tab:sysParams}
\centering{}%
\begin{tabular}{l|l}
\hline 
mass ($m$) & 10 kg \tabularnewline
\hline 
Sampling frequency ($\Delta t$) & 0.005 $s$\tabularnewline
\hline 
Final Time ($t_{f}$) & 1 $s$\tabularnewline
\hline 
Maximum Velocity ($\bar{v}$) & 0.5 $m/s$\tabularnewline
\hline 
Maximum Acceleration ($\bar{a}$) & 4.905 $m/s^{2}$\tabularnewline
\hline 
Maximum Jerk ($\bar{j}$) & 98.1 $m/s^{3}$\tabularnewline
\hline 
Maximum Power ($\bar{P}$) & 100 $W$\tabularnewline
\hline 
\end{tabular}
\end{table}


\subsection{Minimal Velocity}

Fig.~\ref{fig:min_v} shows the minimum velocity trajectories for
all norms studied using the nominal $\bar{j}$ and when $\bar{j}$
is 10 times higher than listed in Table~\ref{tab:sysParams}. For
the nominal jerk allowable, the familiar S-curve trajectory results
from the minimization of the $\mathcal{L}_{2}$ and $\mathcal{L}_{\infty}$
norms. As the allowable jerk increase, these curves morph into the
familiar trapezoidal profile, with indistinguishable results when
using the $\mathcal{L}_{2}$ and $\mathcal{L}_{\infty}$ norms. Another
result of interest here is that the trajectory produced by minimizing
$\|v\|_{1}$ uses less peak power.

\begin{figure}
\centering{}\input{figures/min_v_lowhigh.tex} \caption{Minimum velocity trajectories - nominal $\bar{j}$ (solid) and 10x
$\bar{j}$ (dashed)}
\label{fig:min_v}
\end{figure}


\subsection{Minimal Acceleration and Jerk}

Minimizing the acceleration across the 3 norms results in significantly
different trajectory profiles. . The results shown in Fig.~\ref{fig:min_a}
demonstrate a parabolic velocity profile for minimization of the $\mathcal{L}_{2}$
norm and a triangular profile for minimization of the $\mathcal{L}_{\infty}$
norm. Minimization of the $\mathcal{L}_{1}$ norm of acceleration
is similar to minimization of the $\mathcal{L}_{\infty}$ norm of
velocity, which is expected from the time derivative relationship
between these variables. Fig.~\ref{fig:min_j} shows minimization
of jerk using the three norms. In this the velocity profiles develop
a range of bell shapes, nearing a triangle shape in the case of the
$\mathcal{L}_{1}$ norm. of the system jerk and results in bell shaped
velocity profiles.

\begin{figure}
\begin{centering}
\input{figures/min_a.tex}
\par\end{centering}
\caption{Minimum acceleration trajectories}

\centering{}\label{fig:min_a}
\end{figure}

\begin{figure}
\begin{centering}
\input{figures/min_j.tex}
\par\end{centering}
\caption{Minimum jerk trajectories}

\centering{}\label{fig:min_j}
\end{figure}


\subsection{Minimal Power}

Minimizing power results (Fig. \ref{fig:min_p}) in velocity profiles
that are largely similar to those of acceleration minimization, while
the other profiles are accentuated at the beginning and end of the
motion. Interestingly, the overall peak power using the $\mathcal{L}_{1}$
norm is higher than that of several of the other cases, indicating
that this cost function is not appropriate for power minimization.
 Note, however, that the $\mathcal{L}_{1}$ norm this is also the
minimum total energy solution, as was shown via \eqref{eq:energy}.

\begin{figure}
\begin{centering}
\input{figures/min_p.tex}
\par\end{centering}
\caption{Minimum power trajectories}

\centering{}\label{fig:min_p}
\end{figure}


\subsection{Minimal Time}

The minimal time trajectory results in an S-curve velocity profile.
In separate tests not shown, it was found that as the final time was
manually reduced for any of the previously described optimization
scenarios, the results converged to this same minimum time S-curve
solution. This result can potentially be used to justify the specification
of a different actuator that can meet requirements but will also be
able to lower to total energy used in the motion.

\begin{figure}
\begin{centering}
\input{figures/min_dt.tex}
\par\end{centering}
\caption{Minimum time trajectory}

\centering{}\label{fig:min_t}
\end{figure}


\subsection{Total Energy and Peak Power Comparison}

The generated trajectory profiles for the various optimization problems
considered will naturally exhibit different total energy and peak
power consumption characteristics that may further aid in the selection
of the proper trajectory. A relative comparison of these values for
the above cases is provided in Tables \ref{tab:energy} and \ref{tab:power}.
The total energy was found via trapezoidal integration of the absolute
value of the power. The results were divided by the best case over
all combinations. It can be seen that, in general, minimizing the
velocity resulted in the lowest energy required for the move, which
makes sense as kinetic energy is proportional to the velocity squared.
As expected per previous discussion, the minimization of the $\mathcal{L}_{1}$
norm of Power similarly achieves the minimum total energy mark. Minimal
peak power, on the other hand, is generally reduced by minimizing
the jerk or more directly so by minimizing the $\mathcal{L}_{\infty}$
norm of the power. Simultaneous comparison of these tables illustrates
the well-known tradeoff that must be considered between system specifications
and performance requirements.

\begin{table}
\caption{Total energy relative to best case}
\label{tab:energy}
\centering{}%
\begin{tabular}{|l|c|c|c|c|c|c|}
\hline 
 & $v$ & $a$ & $j$ & $P$ & $E_{total}$ & $t_{f}$\tabularnewline
\hline 
$\|\cdot\|_{1}$ & 1.17 & 1.00 & 3.08 & 1.00 & \multirow{3}{*}{1.00} & \multirow{3}{*}{3.08}\tabularnewline
\cline{1-5} \cline{2-5} \cline{3-5} \cline{4-5} \cline{5-5} 
$\|\cdot\|_{2}$ & 1.17 & 1.85 & 2.80 & 1.39 &  & \tabularnewline
\cline{1-5} \cline{2-5} \cline{3-5} \cline{4-5} \cline{5-5} 
$\|\cdot\|_{\infty}$ & 1.00 & 3.08 & 3.08 & 1.96 &  & \tabularnewline
\hline 
\end{tabular}
\end{table}

\begin{table}
\caption{Peak power relative to best case}
\label{tab:power}
\centering{}%
\begin{tabular}{|l|c|c|c|c|c|c|}
\hline 
 & $v$ & $a$ & $j$ & $P$ & $E_{total}$ & $t_{f}$\tabularnewline
\hline 
$\|\cdot\|_{1}$ & 2.37 & 5.13 & 3.06 & 5.13 & \multirow{3}{*}{5.13} & \multirow{3}{*}{11.2}\tabularnewline
\cline{1-5} \cline{2-5} \cline{3-5} \cline{4-5} \cline{5-5} 
$\|\cdot\|_{2}$ & 5.45 & 1.41 & 2.59 & 1.77 &  & \tabularnewline
\cline{1-5} \cline{2-5} \cline{3-5} \cline{4-5} \cline{5-5} 
$\|\cdot\|_{\infty}$ & 5.13 & 3.06 & 3.33 & 1.00 &  & \tabularnewline
\hline 
\end{tabular}
\end{table}


\subsection{Multi-Objective Trajectory Optimization}

Extension of the trajectory optimization framework to mixed optimization
problems can be easily handled by modifying the cost function in \eqref{eq:baseProgram}
with the weighted multi-objective formulation

\begin{align}
\begin{split} & \min\limits _{\mathbf{x}}\;\sum_{i}w_{i}J_{i}\\
s.t.\quad & \mathcal{C}\\
 & \sum_{i}w_{i}=1
\end{split}
\label{eq:multioptStatement}
\end{align}
where $w_{i}$ are weights for each of the $J_{i}$ cost functions.
Equal weighting of total energy and peak power cost functions results
in the motion profiles shown in Fig. \ref{fig:multiobj_e_p}, which
exhibits a total energy 1.50 times greater and peak power 1.08 times
greater than their respective optimal cases. Varying the cost function
weights provides a means to extracting the multi-objective Pareto
front, as shown in Fig. \ref{fig:pareto} in which weights were varied
from 0 to 1. Representing the range of possible solutions to this
problem, at the extremes the Pareto front replicates the best and
worst energy and power case results shown in Tables \ref{tab:energy}
and \ref{tab:power}. In between lies a trade space between the two
cost functions where an engineer can find a motion profile that appropriately
balances the needs of their particular system.

\begin{figure}
\centering{}\input{figures/multiobj_e_p.tex} \caption{Minimum mixed total energy-peak power objective trajectories -- equal
weighting}
\label{fig:multiobj_e_p}
\end{figure}
\begin{figure}
\centering{}\input{figures/pareto_ep.tex} \caption{Minimum total energy-peak power Pareto front -- normalized to axes
minima}
\label{fig:pareto}
\end{figure}


\section{MULTI-AXIS TRAJECTORY OPTIMIZATION EXAMPLE}

The trajectory optimization framework can be generalized to multi-axis
problems by extension of the problem formulation \eqref{eq:baseProgram}
with new kinematic variables and associated kinematic constraints
\eqref{eq:kinematicConstraints} for each moving body. Also necessary
is the reformulation of the cost and objective function variables
to include coupled effects of the system (e.g., staged motion and
accompanying dynamics).

Here we demonstrate such an extension through and example of a two-link
Selective Compliance Articulated Robotic Arm (SCARA). A SCARA consists
of a fixed rotary joint rotating a link at the end of which another
rotary joint/link pair is situated. In this example, it is clear that
the kinematics of the endpoint of link 2, as well as the joint torque
and power requirements, are coupled and dependent on the relative
motion of the two joints. Derivation of these relationships is straightforward
using Lagrange's equations and will not be reproduced here.

To exercise this example, we define a trajectory generation problem
for the SCARA starting at rest such that the tip velocity $\left\langle v_{x}^{tip},v_{y}^{tip}\right\rangle $
of the second link is equal to $\left\langle 0,v_{f}^{tip}\right\rangle $
at $t_{f}$ (as if it were throwing a baseball). We choose to formulate
the tip velocities as constraints while the cost function minimizes
the equally weighted peak power ($\mathcal{L}_{\infty}$ norm) of
the two joint actuators. In this case we only care about hitting the
velocity target at the end of motion, so the final position and acceleration
constraints $d_{N}$ and $a_{N}$ are removed from the problem formulation.
Note that this does not dictate the position or pose of the SCARA
at the end of motion, only the tip velocity, so there may be many
ways in which the end condition may manifest. An alternative formulation
to this problem could instead add new constraint equations to enforce
the tip velocity at an intermediate point in time.

The solution of this trajectory generation problem is shown through
the following figures. Fig. \ref{fig:SCARA_states} shows the initial
and final positions of the SCARA as well as traces of the tip positons,
Fig. \ref{fig:SCARA_trajectories} shows the motion profiles of the
two joint actuators, and Fig. \ref{fig:SCARA_tip_position-trajectories}
shows the trajectories the link tips. From the motion profiles it
is clear that the position (limited to $\pm\pi$ radians) and jerk
side constraints are being enforced at various points through the
motion, while the peak power cost function manifests as a flattening
of the actuator power curves. An interesting outcome of this example
is that the optimizer plans ``wind-up'' motion for the arm (much
like a pitcher throwing a baseball), which it turns out is required
in order to reach the tip velocities within the given joint position
constraints (i.e., it is not possible to reach the tip speeds if only
forward motion is allowed). The optimization code used for this example,
along with specific link dimensions and properties, is provided on
GitHub at \url{TBDsite}. Readers are encouraged to explore this example
to better understand the relationship between the problem formulation,
variables, and constraints.

\begin{figure}
\centering{}\input{figures/scara2.tex}\caption{SCARA in-plane motion with starting (solid) and ending (dashed) poses}
\label{fig:SCARA_states}
\end{figure}
\begin{figure}
\centering{}\input{figures/2link_trajectory.tex} \caption{SCARA motion profiles}
\label{fig:SCARA_trajectories}
\end{figure}
\begin{figure}
\centering{}\input{figures/2link_tip_position_history_forpaper.tex}
\caption{SCARA tip trajectories}
\label{fig:SCARA_tip_position-trajectories}
\end{figure}


\section{CONCLUSIONS AND FUTURE WORK\label{sec:conclusions}}

This paper provides a straight forward analysis tool for optimizing
servo movement trajectories that motion systems engineers can use
to tailor the performance of their systems. Multiple objectives were
proposed to minimize different aspects of the trajectory profile.
Results showed that minimization of the \textit{$\mathcal{L}_{2}$
and $\mathcal{L}_{\infty}$}-norms resulted in the traditional trapezoidal
and S-curve profiles that are used in many off-the-shelf motion control
systems. It was shown that trapezoidal profiles are the natural extension
of S-curves when the allowable jerk in the system in increased. Also
noted is that a trapezoidal profile is both the solution of the minimal
time trajectory under motion rate constraints as well as for all other
optimization problems considered when under a time constraint that
approaches the minimal time. This suggests that the trapezoidal velocity
profile is equivalent to the minimum move time profile given specific
bounds. Further comparison of total energy and peak power between
the results clearly demonstrate the trade off that must be considered
with selection a motion profile.

A key distinction between the trajectory optimization formulation
presented here and other optimization problem formulations of dynamic
systems is the independence of the kinematic variables. Whereas in
most other formulations the kinematics are constrained implicitly
through the use of a time integration solver or algorithm (e.g., Runge-Kutta
or forward Euler), here the kinematic variables are allowed to fall
out of dynamic equilibrium within the context of the optimization
program (i.e., the kinematic constraints may not be satisfied for
a given optimization iteration). This unique feature affords the present
formulation with additional freedom to explore the optimal solution
landscape by not being required to strictly follow the laws of physics
every step of the way. It is only within the scope of the final solution
that physical laws must be upheld, so it can be envisioned that this
relaxation may bring algorithmic benefits in terms of improved solution
convergence rate and avoidance of local minima, although these suppositions
are not investigated here.

There exist many extensions and/or other use cases of this work, including:
\begin{itemize}
\item Adding friction - Including friction within trajectory optimization
will enable improved power and energy estimates as well as the ability
to derive system friction requirements from system performance specifications.
\item Multi-objective/norm regularization - Exploring other cost function
formulations that allow for more tailored trajectories to balance
the trade offs between power, energy, and actuator limits.
\item Complex profiles - Creating trajectories with varying bounds across
the trajectory, thereby enabling optimization of complex profiles
with specific movement requirements.
\end{itemize}
\bibliographystyle{IEEEtran}
\bibliography{references}

\end{document}
